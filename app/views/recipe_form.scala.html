<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Recipe builder</title>
<<<<<<< HEAD
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/styles.css")">
    <script type="text/javascript" src="@routes.Assets.at("javascripts/jquery.js")"></script>
=======
    <link rel="stylesheet" href="styles/styles.css">
    <script type="text/javascript" src="bower_components/jquery/dist/jquery.js"></script>
>>>>>>> moving the shit
  </head>
  <body>
    <div id="main">
      <h1>Opprettelse av oppskrifter for Mealchooser</h1>
      <!-- <form method="post"> -->

        <!-- Recipe name -->
        <div class="span1of1">
          <label for="name">
            Navn
            <input type="text" id="name" placeholder="Recipe name">
          </label>
        </div>

        <!-- Tags -->
        <div class="span1of1">
          <label for="tags">
            Tags
            <input type="text" id="tags" placeholder="Meksikansk, Taco, Digg...">
          </label>
        </div>

        <!-- Time to make -->
        <label for="time">Tid</label>

        <div class="button-group time span1of1"></div>

        <!-- Recipes language -->
        <div class="span1of1">
          <label for="language">
            Språk
            <select id="language">
              <option value="nb-NO">Norsk</option>
              <option value="en-US">Engelsk</option>
            </select>
          </label>
        </div>

        <!-- Recipes Image -->
        <div class="span1of1 image-section">
          <div class="upload-files">
            <label for="image">
              Lokalt bilde
              <input type="file">
            </label>
          </div>
          <div class="or">ELLER</div>
          <div class="url-upload">
            <label for="image">
              Eksternt bilde
            </label>
            <input type="text" placeholder="URL (funker ikke)" disabled>
          </div>
        </div>

        <div class="preview">
          <img id="preview" />
        </div>

        <!-- Description -->
        <div class="span1of1">
          <label for="description">
            Beskrivelse
            <textarea id="description" placeholder="Markdown :)"></textarea>
          </label>
        </div>

        <!-- Procedure -->
        <div class="span1of1">
          <label for="procedure">
            Fremgangsmåte
            <textarea id="procedure" placeholder="Markdown :)"></textarea>
          </label>
        </div>

        <!-- Strength -->
        <label for="time">Styrke</label>

        <div class="button-group strength span1of1">
          <label>
            <input type="radio" name="button-group-strength" value="1" checked="">
            <span class="button-group-item">1</span>
          </label>
          <label>
            <input type="radio" name="button-group-strength" value="2">
            <span class="button-group-item">2</span>
          </label>
          <label>
            <input type="radio" name="button-group-strength" value="3">
            <span class="button-group-item">3</span>
          </label>
        </div>

        <!-- Ingredients -->
        <div class="span1of1">
          <label for="ingredients">Ingredienser</label>
          <div class="ingredients-wrapper">
            <div class="ingredient">
              <div class="span1of3">
                <input type="text" class="ingredient-name" placeholder="Plomme">
              </div>
              <div class="span1of3">
                <input type="number" class="ingredient-amount" min="0" placeholder="Antall/mengde">
              </div>
              <div class="span1of3 last">
                <select class="ingredient-unit">
                  <option value="gram">Gram</option>
                  <option value="cup">Kopp</option>
                  <option value="liter">Liter</option>
                  <option value="stk">Stk</option>
                  <option value="pinch">Klype</option>
                  <option value="basket">Kurv</option>
                </select>
              </div>
            </div>
          </div>
            
          <button data-js-new-ingredient>Legg til ny ingrediens</button>
        </div>

        <!-- Author -->
        <label for="author">Forfatter</label>
        <div class="span1of3">
          <label for="first-name">
            Fornavn
            <input type="text" id="first-name" placeholder="Even">
          </label>
        </div>
        <div class="span1of3">
          <label for="last-name">
            Etternavn
            <input type="text" id="last-name" placeholder="Lislebø">
          </label>
        </div>
        <div class="span1of3 last">
          <label for="email">
            E-mail
            <input type="text" id="email" placeholder="gurr@gurr.gurr">
          </label>
        </div>

        <!-- Submit -->
        <div class="span1of1">
          <input type="submit" class="pull-right" value="Vis i JSON">
        </div>
      <!-- </form> -->
    </div>

    <pre id="result"></pre>

    <script type="text/javascript">

      $(document).ready(function() {
        var minutes = function(i) {
          var min = 10;
          return min + i * 10;
        }

        var hours = function(minutes) {
          if (minutes < 60) return minutes+"m";
          var h = parseInt(minutes / 60);
          return h +"t "+ (minutes - h * 60)+"m"
        }

        for (var i = 0; i < 14; i++) {
          $('.time').append('<label>'+
          '  <input type="radio" name="button-group-time" value="'+minutes(i)+'">'+
          '  <span class="button-group-item">'+hours(minutes(i))+'</span>'+
          '</label>');
        }
      });

      function readURL(input) {

        if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
            $('#preview').attr('src', e.target.result);
          }
          reader.readAsDataURL(input.files[0]);
        }
      }

      $("[type=file]").change(function(){
          readURL(this);
      });

      $('[data-js-new-ingredient]').click(function() {
        $('.ingredients-wrapper').append('<div class="ingredient"><div class="span1of3">'+
           '   <input type="text" class="ingredient-name" placeholder="Plomme">'+
           ' </div>'+
           ' <div class="span1of3">'+
           '   <input type="number" class="ingredient-amount" min="0" placeholder="Antall/mengde">'+
           ' </div>'+
           ' <div class="span1of3 last">'+
           '   <select class="ingredient-unit">'+
           '     <option value="gram">Gram</option>'+
           '     <option value="cup">Kopp</option>'+
           '     <option value="liter">Liter</option>'+
           '     <option value="stk">Stk</option>'+
           '     <option value="pinch">Klype</option>'+
           '     <option value="basket">Kurv</option>'+
           '   </select>'+
           ' </div></div>');
      });

      $('input[type=submit]').click(function() {
        var name = $('#name').val();
        var tags = $('#tags').val();
        if (tags !== "") { tags = tags.split(','); } else { tags = []; }
        var time = parseInt($('[name=button-group-time]:checked').val());
        var language = $('#language option:selected').val();

        // picture

        var description = $('#description').val();
        var procedure = $('#procedure').val();
        var strength = parseInt($('[name=button-group-strength]:checked').val());
        var ingredients = [];

        var $ing = $('.ingredient');
        $ing.each(function(index, $ingredient) {
          var ingredientname = $('.ingredient-name', $ingredient).val();
          var amount = $('.ingredient-amount', $ingredient).val();
          var unit = $('.ingredient-unit option:selected', $ingredient).val();

          ingredients.push({
            name: ingredientname,
            amount: amount,
            unit: unit
          });
        });

        var firstName = $('#first-name').val();
        var lastName = $('#last-name').val();
        var email = $('#email').val();

        var postObject = {
          name: name,
          tags: tags,
          time: time,
          language: language,
          description: description,
          procedure: procedure,
          strength: strength,
          ingredients: ingredients,
          author: {
            first_name: firstName,
            last_name: lastName,
            email: email
          }
        };

        window.postObject = postObject;

        $('#result').html('<b>The following is going to be posted</b>\n' + 
          JSON.stringify(postObject, null, '\t') + 
          '\n\n<button class="send">Send inn oppskrift</button>');

        $('.send').click(function() {
          console.log(arguments);

          var xhr = $.post('api/recipes', JSON.stringify(postObject));

          xhr.done(function(response) {
            alert('done', JSON.stringify(response));
            location.reload();
          });

          xhr.fail(function() {
            alert('Noe gæli, check console');
            console.log(arguments);
          });
        });

      })
    </script>
  </body>
</html>